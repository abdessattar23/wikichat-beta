<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Chat App</title>
  </head>
  <body>
    <div id="app">
      <h1>Chat Room</h1>
      <div id="login-page">
        <label for="username">Enter a username:</label>
        <input type="text" id="username" />
        <button onclick="login()">Login</button>
      </div>
      <div id="chat-page" style="display: none">
        <div>
          <label for="room-name">Enter a room name:</label>
          <input type="text" id="room-name" />
          <button onclick="createRoom()">Create Room</button>
        </div>
        <div id="rooms"></div>
        <div id="messages"></div>
        <input type="text" id="message" />
        <button onclick="sendMessage()">Send</button>
      </div>
    </div>
    <script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-database.js"></script>
    <script>
    // Initialize Firebase
var config = {
  apiKey: "AIzaSyDoJ6vE_0O1OSiEZGsYu1B86YvmByZFAyw",
    authDomain: "wikichat-beta2.firebaseapp.com",
    projectId: "wikichat-beta2",
    storageBucket: "wikichat-beta2.appspot.com",
    messagingSenderId: "717471861279",
    appId: "1:717471861279:web:cb26f45158847e3dd3e32a"
};
var newRoomRef;
firebase.initializeApp(config);

// Get a reference to the database service
var database = firebase.database();

// Get the input field and set the focus on it
var input = document.getElementById("message");
input.focus();

// Create a new chat room
function createRoom() {
  var roomName = document.getElementById("room-name").value;
  if (roomName != null && roomName.trim() != "") {
    newRoomRef = database.ref().child("rooms/"+roomName);
    
    displayMessages(roomName);
  }
}

// Display the chat rooms
//function displayRooms() {
//  var roomsRef = database.ref().child("rooms");
 // roomsRef.on("value", function(snapshot) {
   // var roomsDiv = document.getElementById("rooms");
    //roomsDiv.innerHTML = "";
    //snapshot.forEach(function(childSnapshot) {
      //var roomKey = childSnapshot.key;
      //var roomName = childSnapshot.val();
      //var roomDiv = document.createElement("div");
      //roomDiv.innerHTML =
        
       // "<a href='#' onclick='displayMessages(roomName)'>" +roomName +"</a>";
        //roomName +
        //"\")'>" +
        //roomName +
        //"</a>";
      //roomsDiv.appendChild(roomDiv);
    //});
  //});
//}

// Display the chat messages
function displayMessages(roomName) {
  var messagesRef = database.ref().child("rooms/" + roomName);
  messagesRef.on("value", function(snapshot) {
    var messagesDiv = document.getElementById("messages");
    messagesDiv.innerHTML = "";
    snapshot.forEach(function(childSnapshot) {
      var message = childSnapshot.val();
      var messageDiv = document.createElement("div");
      messageDiv.innerHTML = message.name + ": " + message.text;
      messagesDiv.appendChild(messageDiv);
    });
  });
}

// Send a chat message
function sendMessage() {
  var messageField = document.getElementById("message");
  var messageText = messageField.value;
  var username = localStorage.getItem("username");

  if (messageText.trim() != "") {
    //var messagesRef = database.ref().child("rooms/" + roomName);
    newRoomRef.push().set({
      name: username,
      text: messageText
    });
    messageField.value = "";
  }
}

// Login to the chat app
function login() {
  var username = document.getElementById("username").value.trim();
  if (username != "") {
    localStorage.setItem("username", username);
    document.getElementById("login-page").style.display = "none";
    document.getElementById("chat-page").style.display = "block";
    //displayRooms();
  }
}
    </script>
  </body>
</html>
